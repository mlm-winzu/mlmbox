# Модель: SlotBranch

## 1. Описание

**`SlotBranch`** — это модель, которая представляет собой **иерархическую связь (ветку)** между родительским `Slot` и местом для дочернего `Slot`.

Эта модель имеет двойственную природу:
1.  **Активная связь**: Когда дочерний `Slot` существует, поле `child_id` заполнено, и `SlotBranch` представляет собой ребро в графе, физически связывающее родителя и потомка.
2.  **Потенциальная связь (Резервация)**: Если поле `child_id` не заполнено (`null`), `SlotBranch` представляет собой "пустую" ветку, которая выступает в роли зарезервированного места или носителя бизнес-данных.

## 2. Назначение и решаемые задачи

Основная задача модели — быть носителем информации о самой ветке, а не только о ее наличии.

### Ключевые задачи:
- **Фиксация иерархии**: Однозначно определяет связь между родительским слотом и его дочерним (или местом для него).
- **Хранение данных ветки**: Позволяет хранить данные, специфичные для конкретной ветки (например, накопленные баллы).
- **Резервация места**: Дает возможность вручную создавать "ветки" для будущего заполнения.

## 3. Процесс создания

- **Автоматически**: Когда под родительским `Slot` создается новый дочерний `Slot` (и для него не была зарезервирована ветка), запись `SlotBranch` создается автоматически.
- **Вручную**: `SlotBranch` можно создать вручную, без дочернего слота. Это действие равносильно "резервации" места. Если впоследствии в эту ветку добавляется `Slot`, он **занимает** существующую запись `SlotBranch`.

## 4. Сценарии использования (кейсы)

- **Стандартное создание слота**: Новый `Slot` создается под родительским. Система создает `SlotBranch` с заполненными `parent_id` и `child_id`.
- **Смена родителя (по заявке)**: По запросу, `Slot`-потомок открепляется от своего родителя. Система находит их `SlotBranch` и обнуляет в ней поле `child_id`. Затем потомок может быть привязан к новому родителю путем обновления `child_id` в другой ветке.
- **Компрессия**: Важно отметить, что Компрессия — это более сложный, высокоуровневый процесс слияния `TreePartition`. Этот процесс **использует** механику смены родителя для перепривязки целых структур (`root_slot_id`), но сама логика компрессии описана в документации `TreePartition`.

## 5. Связи с другими моделями

- **`Slot`**: `SlotBranch` **всегда** ссылается на родительский `Slot` через `parent_id`. Она также **может** ссылаться на дочерний `Slot` через необязательное поле `child_id`.
- **`SlotBranchPolicy`**: `SlotBranch` **управляется** одной политикой.
