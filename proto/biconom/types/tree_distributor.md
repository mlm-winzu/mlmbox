# Модель: TreeDistributor

## 1. Описание

**`TreeDistributor`** — это ассоциативная модель (модель-связка), которая соединяет `Tree` и `Distributor`. Она представляет собой запись о том, что определенный дистрибьютор является участником определенного дерева.

## 2. Назначение и решаемые задачи

Основная задача этой модели — эффективно отслеживать участие дистрибьюторов в различных деревьях и управлять состоянием этого участия.

### Ключевые задачи:
- **Фиксация участия**: Создание записи `TreeDistributor` формально означает, что `Distributor` присоединился к `Tree`.
- **Управление состоянием через политики**: Поле `policy_id` позволяет применять к связи централизованно управляемые политики (`TreeDistributorPolicy`).
- **Оптимизация запросов**: Позволяет быстро ответить на вопросы:
  - "В каких деревьях состоит данный дистрибьютор?"
  - "Какие дистрибьюторы участвуют в данном дереве?"

## 3. Ключевые поля и концепции

- `tree_id`: ID дерева, к которому присоединился дистрибьютор.
- `distributor_id`: ID дистрибьютора, который присоединился к дереву.
- `policy_id`: Обязательное поле. Связь всегда подчиняется правилам, определенным в соответствующей `TreeDistributorPolicy`. Должна существовать как минимум "политика по умолчанию".

## 4. Сценарии использования (кейсы)

- **Первая покупка слота**: Когда `Distributor` впервые покупает `Slot` в `Tree`, создается запись `TreeDistributor`.
- **Приостановка участия в маркетинге**: Администратор применяет `policy_id` к `TreeDistributor` тех участников, которые нарушили правила данного "дерева".

## 5. Связи с другими моделями

- **`Tree`**: `TreeDistributor` **ссылается** на одно `Tree` (связь по `tree_id`).
- **`Distributor`**: `TreeDistributor` **ссылается** на одного `Distributor` (связь по `distributor_id`).
- **`TreeDistributorPolicy`**: `TreeDistributor` **управляется** одной политикой (связь по `policy_id`).
