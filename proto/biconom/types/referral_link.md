# Модель: ReferralLink

## 1. Описание

**`ReferralLink`** — это модель, представляющая собой реферальную ссылку, которая используется для привлечения и регистрации новых участников в иерархическую структуру.

## 2. Назначение и решаемые задачи

Основная цель — создать гибкую и управляемую систему реферальных ссылок, поддерживающую как простые персональные, так и сложные коллективные сценарии.

### Ключевые задачи:
- **Идентификация**: Каждая ссылка имеет уникальный `code`, который является частью URL.
- **Определение типа**: Поле `kind` четко разделяет персональные и коллективные ссылки, что определяет логику поиска дистрибьютора-цели на бэкенде.
- **Определение владельца**: Поле `account_id` четко определяет, какой аккаунт создал и владеет этой ссылкой.
- **Управление правилами**: Поле `policy_id` связывает ссылку с ее политикой.

## 3. Ключевые поля и концепции

- `code`: Уникальный код, используемый в URL.
- `kind`: `enum`, определяющий тип ссылки:
  - **`PERSONAL`**: При регистрации по этой ссылке бэкенд находит дистрибьютора, связанного с `account_id` владельца ссылки.
  - **`COLLECTIVE`**: При регистрации по этой ссылке бэкенд использует логику, определенную в `ReferralLinkPolicy`, для выбора дистрибьютора-цели (например, "ротатор" или "балансировщик").
- `status`: `enum`, определяющий, активна ли ссылка.
- `account_id`: ID аккаунта-владельца.
- `policy_id`: Обязательная ссылка на `ReferralLinkPolicy`.

## 4. Сценарии использования (кейсы)

- **Создание персональной ссылки**: Партнер (с `account_id: 100`) создает для себя ссылку. Система генерирует `ReferralLink` с `kind: PERSONAL` и `account_id: 100`.
- **Создание коллективной ссылки для команды**: Лидер команды (с `account_id: 200`) создает ссылку. Система генерирует `ReferralLink` с `kind: COLLECTIVE` и `policy_id` от политики "Round_Robin_Policy".

## 5. Связи с другими моделями

- **`Account`**: `ReferralLink` **принадлежит** одному `Account`.
- **`ReferralLinkPolicy`**: `ReferralLink` **управляется** одной политикой.
- **`Distributor`**: `ReferralLink` **косвенно ссылается** на одного или нескольких `Distributor` через логику, определяемую ее `kind` и `policy_id`.
