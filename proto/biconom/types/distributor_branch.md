# Модель: DistributorBranch

## 1. Описание

**`DistributorBranch`** — это модель, которая представляет собой **иерархическую связь (ветку)** между родительским `Distributor` и местом для дочернего `Distributor`.

Эта модель имеет двойственную природу:
1.  **Активная связь**: Когда дочерний `Distributor` существует, поле `child_id` заполнено, и `DistributorBranch` представляет собой ребро в графе, физически связывающее родителя и потомка.
2.  **Потенциальная связь (Пустое место)**: Если поле `child_id` не заполнено (`null`), `DistributorBranch` представляет собой "пустую" ветку, готовую для заполнения новым дистрибьютором.

## 2. Назначение и решаемые задачи

Основная задача модели — быть носителем информации о самой ветке.

### Ключевые задачи:
- **Фиксация иерархии**: Однозначно определяет связь между родительским дистрибьютором и его дочерним (или местом для него).
- **Управление структурой**: Позволяет отслеживать "пустые" и "занятые" места в иерархии под каждым дистрибьютором.

## 3. Процесс создания

- **Автоматически**: Когда под родительским `Distributor` создается новый дочерний `Distributor`, запись `DistributorBranch` создается автоматически, и в ее поле `child_id` записывается `id` нового дистрибьютора.
- **Вручную**: `DistributorBranch` можно создать вручную с пустым полем `child_id`. Если впоследствии в эту ветку добавляется `Distributor`, он **занимает** существующую запись, обновляя ее `child_id`.

## 4. Сценарии использования (кейсы)

- **Стандартная регистрация партнера**: Новый `Distributor` регистрируется под "спонсором". Система создает `DistributorBranch` с заполненными `parent_id` и `child_id`.
- **Смена спонсора (по заявке)**: По запросу, `Distributor`-потомок открепляется от своего родителя. Для этого система находит их `DistributorBranch` и обнуляет в ней поле `child_id`. Затем потомок может быть привязан к новому родителю путем обновления `child_id` в другой ветке.
- **Компрессия**: Важно отметить, что Компрессия — это более сложный, высокоуровневый процесс слияния `NetworkPartition`. Этот процесс **использует** механику смены родителя для перепривязки целых структур (`root_distributor_id`), но сама логика компрессии описана в документации `NetworkPartition`.

## 5. Связи с другими моделями

- **`Distributor`**: `DistributorBranch` **всегда** ссылается на родительский `Distributor` через `parent_id`. Она также **может** ссылаться на дочерний `Distributor` через необязательное поле `child_id`.
- **`DistributorBranchPolicy`**: `DistributorBranch` **управляется** одной политикой.
