# Модель: TreePartition

## 1. Описание

**`TreePartition`** (партиция дерева) — это модель, представляющая собой выделенную часть, сегмент или "поддерево" внутри глобального `Tree`. Каждая партиция имеет свой корневой слот (`root_slot_id`), с которого она начинается.

## 2. Назначение и решаемые задачи

Партиции вводятся для управления структурными изменениями в дереве, такими как слияние (`merge`) и разделение (`split`) иерархий. **Партиция создается только тогда, когда в иерархии появляется новый "корень", не привязанный к существующей структуре.**

### Ключевые задачи:
- **Сегментация**: `TreePartition` делит одно огромное `Tree` на управляемые логические части.
- **Управление поведением через политики**: Поле `policy_id` позволяет применять к партиции централизованно управляемые политики (`TreePartitionPolicy`), которые определяют ее поведение (например, возможность слияния).
- **Отслеживание жизненного цикла**: Флаг `is_archived` показывает, что партиция была слита с другой и больше не является активной.

## 3. Ключевые поля и концепции

- `root_slot_id`: ID корневого слота (`Slot`), с которого начинается эта партиция.
- `policy_id`: Обязательное поле. Партиция всегда подчиняется правилам, определенным в соответствующей `TreePartitionPolicy`.
- `is_archived`: Флаг, который устанавливается в `true` после того, как партиция была успешно слита с другой. Архивная партиция является исторической записью.

## 4. Сценарии использования (кейсы)

- **Создание корневого слота**: Создается `Slot` без родителя. Для него создается новая `TreePartition`, которой назначается `policy_id` с правилом `is_mergeable = false`.
- **Слияние партиций (Merge)**: По решению бизнес-логики, одна партиция ("отдающая") сливается с другой.
  1. `root_slot_id` "отдающей" партиции перепривязывается к новому родительскому слоту.
  2. У "отдающей" партиции флаг `is_archived` устанавливается в `true`.
  3. Обновляются все необходимые метрики у затронутых слотов.

## 5. Связи с другими моделями

- **`Tree`**: `TreePartition` **является частью** одного `Tree`.
- **`Slot`**: `TreePartition` **начинается с** одного `Slot`.
- **`TreePartitionPolicy`**: `TreePartition` **управляется** одной политикой.
