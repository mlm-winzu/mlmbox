# Модель: NetworkPartition

## 1. Описание

**`NetworkPartition`** (партиция сети) — это модель, представляющая собой выделенную часть, сегмент или "подсеть" внутри глобальной `Network`. Каждая партиция имеет своего корневого дистрибьютора (`root_distributor_id`), с которого она начинается.

## 2. Назначение и решаемые задачи

Партиции сетей вводятся для управления структурными изменениями в иерархии дистрибьюторов, такими как слияние (`merge`) и разделение (`split`). **Партиция создается только тогда, когда в иерархии появляется новый "корень", не привязанный к существующей структуре.**

### Ключевые задачи:
- **Сегментация**: `NetworkPartition` делит одну огромную `Network` на управляемые логические части.
- **Управление поведением через политики**: Поле `policy_id` позволяет применять к партиции централизованно управляемые политики (`NetworkPartitionPolicy`), которые определяют ее поведение (например, возможность слияния).
- **Отслеживание жизненного цикла**: Флаг `is_archived` показывает, что партиция была слита с другой и больше не является активной.

## 3. Ключевые поля и концепции

- `root_distributor_id`: ID корневого дистрибьютора (`Distributor`), с которого начинается эта партиция.
- `policy_id`: Обязательное поле. Партиция всегда подчиняется правилам, определенным в `NetworkPartitionPolicy`.
- `is_archived`: Флаг, который устанавливается в `true` после того, как партиция была успешно слита с другой.

## 4. Сценарии использования (кейсы)

- **Регистрация без реферала**: `Distributor` регистрируется без спонсора. Для него создается новая `NetworkPartition`, которой назначается `policy_id` с правилом `is_mergeable = true`.
- **Слияние партиций (Merge)**: По решению бизнес-логики, одна партиция ("отдающая") сливается с другой.
  1. `root_distributor_id` "отдающей" партиции перепривязывается к новому родительскому дистрибьютору.
  2. У "отдающей" партиции флаг `is_archived` устанавливается в `true`.
  3. Обновляются все необходимые метрики у затронутых дистрибьюторов.

## 5. Связи с другими моделями

- **`Network`**: `NetworkPartition` **является частью** одной `Network`.
- **`Distributor`**: `NetworkPartition` **начинается с** одного `Distributor`.
- **`NetworkPartitionPolicy`**: `NetworkPartition` **управляется** одной политикой.
